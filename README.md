MEPHI Blood Donation Bot

Комплексный Telegram-бот для управления донорским движением в НИЯУ МИФИ (Национальный исследовательский ядерный университет МИФИ). Бот обеспечивает регистрацию пользователей, управление мероприятиями, информационную поддержку и административные функции для университетской программы донорства крови.

Архитектура проекта

Структура файлов

```
├── main.py                 # Точка входа в приложение
├── bot.py                  # Конфигурация бота и регистрация обработчиков
├── handlers.py             # Основные обработчики взаимодействий с пользователями
├── admin.py                # Административные функции
├── models.py               # ORM модели базы данных (SQLAlchemy)
├── database.py             # Подключение к базе данных и управление сессиями
├── keyboards.py            # Определения inline-клавиатур Telegram
├── messages.py             # Централизованные шаблоны сообщений
├── utils.py                # Утилиты для валидации и обработки данных
├── excel_export.py         # Функции экспорта данных в Excel
├── menu_commands.py        # Команды меню бота
├── import_data.py          # Импорт данных из Excel файлов
└── attached_assets/        # Приложенные файлы (база данных Excel, документы)
```

Ключевые компоненты

Модели базы данных
- **User**: Информация пользователей, тип (студент/сотрудник/внешний), права доступа
- **BloodCenter**: Информация о центрах донорства крови
- **Event**: События донорства с датами и центрами
- **EventRegistration**: Регистрации пользователей на события
- **Donation**: Исторические записи о донациях
- **Question**: Вопросы пользователей администраторам
- **InfoSection**: Статические информационные разделы

 Запуск проекта

Требования
- Python 3.11+
- PostgreSQL база данных
- Telegram Bot Token

Переменные окружения
```bash
BOT_TOKEN=ваш_telegram_bot_token
DATABASE_URL=postgresql://пользователь:пароль@хост:порт/база_данных
```

Установка зависимостей
```bash
pip install python-telegram-bot sqlalchemy psycopg2-binary pandas openpyxl
```

Запуск
```bash
python main.py
```

 Доступ к панели администратора

Для организаторов хакатона:

1. Получение прав администратора
Используйте специальный код для получения прав админа:
```
/promote mephi_admin_2024
```

**Важно**: Сначала нужно зарегистрироваться в боте через `/start`, затем использовать код.

2. Доступ к админ-панели
После получения прав администратора:
- Используйте команду `/admin` 
- Или нажмите кнопку "Админ-панель" в главном меню

3. Функции администратора

**Управление пользователями:**
- Просмотр статистики пользователей
- Добавление/редактирование доноров
- Управление регистрациями

**Управление событиями:**
- Создание новых мероприятий донорства
- Редактирование существующих событий
- Просмотр статистики регистраций

**Ответы на вопросы:**
- Просмотр новых вопросов пользователей
- Ответы с автоматической рассылкой всем, кто задавал вопросы
- Система уведомлений

**Экспорт данных:**
- Автоматический экспорт в Excel формат
- Файлы: `mephi_donors_export_YYYYMMDD_HHMMSS.xlsx`
- Обновление данных при завершении донаций

**Рассылки:**
- Массовые сообщения по категориям пользователей
- Целевые аудитории: студенты, сотрудники, внешние доноры

Функционал для пользователей

Основные возможности
- **Регистрация**: Верификация по номеру телефона, выбор типа пользователя
- **События**: Просмотр и регистрация на дни донора
- **Информация**: Требования к донорам, противопоказания, льготы
- **Статистика**: Личная история донаций, рейтинги доноров
- **Вопросы**: Система вопросов с ответами администраторов

Команды бота
- `/start` - Главное меню
- `/profile` - Профиль пользователя
- `/register` - Регистрация на события
- `/events` - Предстоящие события
- `/stats` - Личная статистика
- `/history` - История донаций
- `/rating` - Рейтинг доноров
- `/centers` - Информация о центрах
- `/benefits` - Льготы доноров
- `/info` - Общая информация
- `/contact` - Контактная информация
- `/feedback` - Система отзывов
- `/help` - Справка по командам
- `/admin` - Панель администратора

 Техническая реализация

База данных
- **PostgreSQL** с автоматическим созданием таблиц
- **SQLAlchemy ORM** для работы с данными
- Контекстные менеджеры для чистой работы с сессиями

Telegram интеграция
- Использование webhook или polling для обновлений
- Inline-клавиатуры для взаимодействия
- Верификация через контакты телефона
- Callback queries для навигации по меню

Excel интеграция
- Автоматический экспорт данных доноров
- Обновление при завершении донаций
- Использование pandas и openpyxl для работы с файлами

Безопасность
- Верификация номера телефона для аутентификации
- Проверка прав администратора для чувствительных операций
- Валидация всех пользовательских входных данных
- Управление согласием для соответствия GDPR

 Система данных

Импорт существующих данных
В проекте используется реальная база данных доноров (файл Excel в attached_assets), содержащая 48 записей с историей донаций для центров Гаврилова и ФМБА.

Автоматическое обновление
При завершении донаций система автоматически:
- Записывает данные в базу данных
- Обновляет Excel файл с новыми записями
- Пересчитывает статистику пользователя
- Обновляет рейтинги доноров

 Конфигурация для разработки

Отладка
Логи доступны в консоли workflow "MEPHI Bot"

Тестирование
1. Регистрация тестового пользователя через `/start`
2. Получение прав админа: `/promote mephi_admin_2024`
3. Тестирование всех функций через интерфейс бота

Развертывание
Проект настроен для работы на Replit с автоматическим управлением зависимостями и переменными окружения.

 Статистика и мониторинг

Доступные метрики
- Общее количество пользователей
- Количество донаций по центрам
- Статистика регистраций на события
- Активность пользователей по типам

Excel отчеты
Автоматически генерируемые файлы содержат:
- Полную информацию о донорах
- Историю донаций
- Статистику по центрам крови
- Данные о регистре костного мозга

---

**Для технической поддержки и вопросов по настройке обращайтесь к разработчику проекта.**

**Статус проекта**:  Полностью функционален, все системы операционны